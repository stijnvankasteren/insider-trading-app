{% extends "app/_layout.html" %}
{% set page_subtitle = "Overview of latest signals (data ingestion will populate this)." %}
{% block app_content %}
  <div class="grid gap-4 md:grid-cols-3">
    <div class="rounded-xl border border-slate-800 bg-slate-900/40 p-4">
      <div class="text-xs text-slate-400">Latest 24h</div>
      <div class="mt-1 text-2xl font-semibold">{{ total_24h }}</div>
      <div class="mt-2 text-xs text-slate-500">Trades ingested</div>
    </div>
    <div class="rounded-xl border border-slate-800 bg-slate-900/40 p-4">
      <div class="text-xs text-slate-400">Top ticker</div>
      <div class="mt-1 text-2xl font-semibold">{{ top_ticker or "—" }}</div>
      <div class="mt-2 text-xs text-slate-500">By trade count</div>
    </div>
    <div class="rounded-xl border border-slate-800 bg-slate-900/40 p-4">
      <div class="text-xs text-slate-400">Newest form</div>
      <div class="mt-1 text-2xl font-semibold">
        {% if latest_form %}
          {{ latest_form }}
        {% else %}
          —
        {% endif %}
      </div>
      <div class="mt-2 text-xs text-slate-500">Connected via n8n</div>
    </div>
  </div>

  <div class="mt-8 overflow-hidden rounded-xl border border-slate-800">
    <div class="border-b border-slate-800 bg-slate-900/40 px-4 py-3 text-sm font-medium">
      Latest trades
    </div>
    {% if latest_trades and latest_trades|length > 0 %}
      <div class="overflow-x-auto bg-slate-950">
        <table class="w-full text-left text-sm">
          <thead class="bg-slate-900/30 text-xs uppercase tracking-wide text-slate-400">
            <tr>
              <th class="px-4 py-3">Traded</th>
              <th class="px-4 py-3">Ticker</th>
              <th class="px-4 py-3">Person</th>
              <th class="px-4 py-3">Type</th>
              <th class="px-4 py-3">Form</th>
              <th class="px-4 py-3">Amount</th>
              <th class="px-4 py-3">Score</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-900/60">
            {% for t in latest_trades %}
              <tr class="hover:bg-slate-900/20">
                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
                  {{ t.transaction_date or "—" }}
                </td>
                <td class="px-4 py-3 whitespace-nowrap font-medium">
                  {% if t.ticker %}
                    <a class="hover:underline" href="/app/companies/{{ t.ticker }}">{{ t.ticker }}</a>
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
                  {% if t.person_slug %}
                    <a class="hover:underline" href="/app/people/{{ t.person_slug }}">{{ t.person_name or t.person_slug }}</a>
                  {% else %}
                    {{ t.person_name or "—" }}
                  {% endif %}
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
                  {{ tx_label(t.form, t.transaction_type) }}
                </td>
                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
                  {{ t.form or "—" }}
	                </td>
	                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
	                  {% if t.amount_usd_low is not none or t.amount_usd_high is not none %}
	                    {% if t.amount_usd_low is not none and t.amount_usd_high is not none and t.amount_usd_low != t.amount_usd_high %}
	                      ${{ t.amount_usd_low }} – ${{ t.amount_usd_high }}
	                    {% else %}
	                      ${{ t.amount_usd_low if t.amount_usd_low is not none else t.amount_usd_high }}
	                    {% endif %}
	                  {% else %}
	                    —
	                  {% endif %}
	                </td>
	                <td class="px-4 py-3 whitespace-nowrap text-slate-300">
	                  {% set score = score_trade(t) %}
	                  {% if score is not none %}
	                    <span class="text-xs font-medium {{ 'text-emerald-300' if score >= 70 else 'text-amber-300' if score >= 50 else 'text-rose-300' }}">
	                      {{ score }}
	                    </span>
	                  {% else %}
	                    —
	                  {% endif %}
	                </td>
	              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="bg-slate-950 px-4 py-8 text-sm text-slate-400">
        No trades yet. Once n8n pushes data, they will appear here.
      </div>
    {% endif %}
  </div>
{% endblock %}
