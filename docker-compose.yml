services:
  db:
    image: ${DB_IMAGE:-postgres:16}
    environment:
      POSTGRES_USER: "${POSTGRES_USER:-postgres}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-change-me}"
      POSTGRES_DB: "${POSTGRES_DB:-alldata}"
    volumes:
      - db_data:/var/lib/postgresql/data
    ports:
      - "${DB_PORT_MAPPING:-5432:5432}"

  web:
    build:
      context: ${WEB_BUILD_CONTEXT:-.}
      dockerfile: Dockerfile
    environment:
      APP_NAME: "${APP_NAME:-AltData}"
      # Keep these in sync with the `db` service (or set them via `.env`).
      POSTGRES_USER: "${POSTGRES_USER:-postgres}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-change-me}"
      POSTGRES_DB: "${POSTGRES_DB:-alldata}"
      DATABASE_URL: "postgresql+psycopg://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-change-me}@${POSTGRES_HOST:-db}:${POSTGRES_PORT:-5432}/${POSTGRES_DB:-alldata}"
      INGEST_SECRET: "${INGEST_SECRET:-change-me}"
      PUBLIC_BASE_URL: "${PUBLIC_BASE_URL:-http://localhost:8000}"
      AUTH_DISABLED: "${AUTH_DISABLED:-true}"
      APP_PASSWORD: "${APP_PASSWORD:-change-me}"
      SESSION_SECRET: "${SESSION_SECRET:-change-me-to-a-long-random-string}"
      COOKIE_SECURE: "${COOKIE_SECURE:-false}"
    ports:
      - "${WEB_PORT_MAPPING:-8000:8000}"
    depends_on:
      - db

volumes:
  db_data:
